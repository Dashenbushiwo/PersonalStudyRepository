# Spring

## 一. Spring概述
1. Spring是轻量级开源的JavaEE框架
2. Spring可以解决企业应用开发的复杂性
3. Spring有两个核心：IOC和AOP

  + IOC：控制反转，把创建对象的过程交给Spring管理
  + AOP：面向切面编程，不修改源代码进行功能增强

## 二. IOC

1. Spring IOC思想基于IOC容器完成，IOC容器底层就是对象工厂
2. Spring提供IOC容器实现的两种方式

    + BeanFactory:IOC容器基本实现，是Spring内部使用的接口，不提供给开发人员使用；加载配置获取时不会创建对象，使用时才创建
    + ApplicationContext：BeanFactory接口的子接口，提供更多强大的功能，一般由开发人员进行使用；加载配置文件时就会把配置文件对象进行创建

## 三. IOC操作bean

1. Spring有两种类型bean，一种普通bean，另一种工厂bean（FactoryBean）
2. 普通bean：在配置文件中定义bean类型就是返回类型
3. 工厂bean：在配置文件中定义bean类型可以和返回类型不一样

   + 第一步 创建类，让类作为工厂bean，实现接口FactoryBean
   + 第二步 实现接口里面的方法，在实现的方法中返回的bean类型

## 四. AOP

1. 面向切面编程，利用AOP可以对业务逻辑的各个部分进行隔离，从而使得业务逻辑各部分之间的耦合度降低，提高程序的可重用性，同时提高开发效率
2. 底层使用动态代理
3. 术语

   + 连接点：类里面哪些方法可以被增强，这些方法就称为连接点
   + 切入点：实际被增强的方法，称为切入点
   + 通知（增强）：实际增强的逻辑部分称为通知（增强）；有5种通知类型，前置、后置、环绕、异常及最终通知
   + 切面：是动作，把通知应用到切入点的过程

4. Spring框架一般都是基于AspectJ实现AOP操作，AspectJ不是Spring组成部分，是独立的AOP框架，只是一般两种一起使用进行AOP操作

## 四. 切入点表达式

1. 切入点表达式：指定哪个类哪个方法需要进行增强
2. 语法结构：execution([权限修饰符][返回类型][类全路径][方法名称][参数列表])

## 五. 事务

1. 事务是数据库操作最基本单元，逻辑上一组操作，要么都成功，如果有一个失败则所有操作都失败
2. 事务的四个特性

   + 原子性
   + 一致性
   + 隔离性
   + 持久性
   
3. Spring中事务管理有编程式事务管理和声明式事务管理两种
4. Spring进行声明式事务管理，底层使用AOP原理
5. Spring事务管理API，提供了一个接口PlatformTransactionManager，针对不同框架有不同实现
6. Transactional参数配置

   + propagation：事务传播行为即多事务方法直接调用，这个过程事务是如何管理的
     1. REQUIRED：如果有事务在运行，当前方法就在这个事务内运行，否则新启动一个事务，并在自己的事务内运行
     2. REQUIRED_NEW：当前的方法必须启动新事务，并在自己的事务内运行，如果有事务正在运行，则将对应事务挂起
     3. SUPPORTS：如果有事务运行，当前的方法就在这个事务内运行，否则可以不运行在事务中
     4. NOT_SUPPORTED：当前方法不应该运行在事务中，如果有运行中的事务，则将它挂起
     5. MANDATORY：当前的方法必须运行在事务内部，如果没有正在运行的事务，就抛出异常
     6. NEVER：当前方法不应该运行在事务中，如果有事务正在运行则抛出异常
     7. NESTED：如果有事务在运行，当前的方法就应该在这个事务的嵌套事务内运行，否则，就启动一个新的事务，并在它自己的事务内运行
   + isolation：事务隔离级别：解决并发可能产生的问题，脏读，不可重复读，虚（幻）读
     1. READ UNCOMMITTED：读未提交，不可解决任何问题
     2. READ COMMITTED：读已提交，解决了脏读问题
     3. REPEATABLE READ：可重复读，解决不可重复读问题
     4. SERIALIZABLE：串行化，解决虚（幻）读问题
   + timeout：超时时间，事务需要在一定时间内进行提交，如果不提交则进行回滚；默认值是-1（不超时），单位是秒
   + readOnly：是否只读，默认false
   + rollbackFor：设置出现哪些异常进行事务回滚
   + noRollbackFor：设置出现哪些异常不进行事务回滚

## 六. Spring5新功能
1. 整个Spring5框架代码基于java8，运行时兼容java9，许多不建议使用的类和方法在代码库中删除
2. Spring 5.0自带了通用的日志封装，也可再整合其它日志，Spring5已经移除Log4jConfigListener，官方建议使用Log4j2
3. 支持@Nullable注解，方法上面表示返回值可以为空，属性上表示属性值可以为空，参数上表示参数可以为空
4. 支持整合Junit5

## 七. WebFlux
待Spring MVC, maven, springboot 后补充